{{ define "head" }}
<link rel="preload" href="/fonts/NouveauDropCaps.woff2" as="font">
{{ end }}

{{ define "main" }}
<img class="background" width="0" height="0" alt="Page Background" role="presentation" src="{{(resources.Get "image/desktop.jpg").RelPermalink}}" />
<div class="post">
<main>
<div class="post-anchor">
{{- with .Resources.GetMatch "cover.*" -}}
<div class="banner-holder">
<img width="800" height="400" alt={{.Title}} role="banner" class="banner" src="{{(.Fill " 800x400 ").RelPermalink}}" />
</div>
{{end}}
<h1>{{.Title}}</h1>
</div>
{{- .Content -}}
</main>
<aside>
  {{- partial "post/info" . -}}
  {{range .Params.sidebar}}
  <section class="sidebar">
    {{with .title}}<h2>{{ . | humanize }}</h2>{{end}}
    {{with .content}}<p>{{ . | markdownify }}</p>{{end}}
  </section>
  {{ end }}
  {{- partial "post/tag-cloud" . -}}
  {{ with .Params.attribution }}
  <section class="sidebar">
      <h2>Attribution</h2>
      <p>{{ . | markdownify }}</p>
  </section>
  {{ end }}
  {{range $.Site.Params.sidebar}}
  <section class="sidebar">
    {{with .title}}<h2>{{ . | humanize }}</h2>{{end}}
    {{with .content}}<p>{{ . | markdownify }}</p>{{end}}
  </section>
  {{ end }}
</aside>
 {{ $related := .Site.RegularPages.RelatedIndices . "tags" "date" "category" | first 5 }}
  {{ with $related }}
<section class="more">
  <h2>Similar Posts</h2>
  <ul>
 {{ range . }}
<li>
  <a href="{{ .RelPermalink }}">{{ .Title }}</a>
</li>
{{ end }}
</ul>
</section>
{{ end }}
{{ $ID := .UniqueID }}
{{ with $.Site.Params.comment }}
<section class="comments">
  <h2>Comments</h2>
 {{ $comments := getCSV "," ( printf "https://docs.google.com/feeds/download/spreadsheets/Export?key=%s&exportFormat=csv" .sheet ) }}
 <ul>
 {{ range $r := $comments }}
  {{ if eq (index $r 3) $ID}}
  {{ $.Scratch.Set "hasComment" true }}
  <li>
    {{ $time := index $r 0}}
    <time datetime="{{$time}}">{{(time $time).Format "Monday, Jan 2, 2006."}}</time>
    <img src="https://www.gravatar.com/avatar/{{ md5 (index $r 1) }}?s=100&d=identicon">
    <span class="commenter-name">{{ index $r 2 }}</span>
    <div class="commenter-comment">{{ index $r 4 | emojify }}</div>
  </li>
  {{ end }}
 {{ end }}
  {{ if ne ($.Scratch.Get "hasComment") true }}
  <li>
    No comments yet. Be the first to post.
  </li>
  {{ end }}
 {{ $.Scratch.Delete "hasComment" }}
 </ul>
  <h3>Post a new comment</h3>
<p>We get avatars from
  <a href="https://www.gravatar.com">Gravatar</a>. You can use emojis as per the <a href="https://www.webfx.com/tools/emoji-cheat-sheet/">Emoji cheat sheet.</a></p>
<form action="https://docs.google.com/forms/d/e/{{.form}}/formResponse">
  {{- with .name -}}
  <input class="comment-name" required type="name" autocomplete="given-name" placeholder="Name" name="{{.}}">
  {{- end -}}
 {{- with .email -}}
  <input class="comment-email`" required type="email" autocomplete="email" placeholder="Email address" name={{.}}>
  {{- end -}}
  {{- with .post -}}
  <input class="comment-id" name="entry.524983228" type="hidden" value="{{$ID}}">
  {{- end -}}
  {{- with .comment -}}
  <textarea class="comment-text" name="{{.}}" placeholder="Your comment" required></textarea>
  {{- end -}}
  <button type="submit">Post Comment</button>
</form>
</section>
{{- end -}}
</div>
{{- end -}}
